ВЫВОД ПОКУПАТЕЛЕЙ С КОЛИЧЕСТВОМ ОСУЩЕСТВЛЁННЫХ ПОКУПОК

SELECT 
    p.идентификатор, 
    p.имя, 
    p.фамилия, 
    COUNT(py.идентификатор) AS количество_покупок
FROM 
    Покупатели p
LEFT JOIN 
    Покупки py ON p.идентификатор = py.ключ покупателя
GROUP BY 
    p.идентификатор, p.имя, p.фамилия;



ОБЩАЯ СТОИМОСТЬ ТОВАРОВ ДЛЯ КАЖДОГО ПОКУПАТЕЛЯ И СОРТИРОВКА РЕЗУЛЬТАТА В ПОРЯДКЕ УБЫВАНИЯ

SELECT 
    p.идентификатор, 
    p.имя, 
    p.фамилия, 
    SUM(t.стоимость) AS общая_стоимость
FROM 
    Покупатели p
JOIN 
    Покупки py ON p.идентификатор = py.ключ покупателя
JOIN 
    Товары t ON py.ключ товара = t.идентификатор
GROUP BY 
    p.идентификатор, p.имя, p.фамилия
ORDER BY 
    общая_стоимость DESC;



ПОЛУЧЕНИЕ ПОКУПАТЕЛЕЙ, КУПИВШИХ ТОЛЬКО ОДИН ТОВАР

SELECT 
    p.идентификатор, 
    p.имя, 
    p.фамилия
FROM 
    Покупатели p
JOIN 
    Покупки py ON p.идентификатор = py.ключ покупателя
GROUP BY 
    p.идентификатор, p.имя, p.фамилия
HAVING 
    COUNT(py.ключ товара) = 1;
